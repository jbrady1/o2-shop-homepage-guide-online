/*
 * eGain Offers Engine
 * Copyright(c) 2011 eGain Communications Corp.
 */
eGOFR.IsFirstInteraction=true;eGOFR.PartitionId=1;eGOFR.PageAccessedTime=-1;eGOFR.Chathandle=null;eGOFR.BrowserTypeIE=(navigator.appName=="Microsoft Internet Explorer")?true:false;eGOFR.Timers=[];eGOFR.Expressions=[];eGOFR.ValueOfExpressions=[];eGOFR.BoolExpMapForOr={};eGOFR.BoolExpMapForAnd={};eGOFR.AllConditionsForRule={};eGOFR.TimeOnFieldMap=[];eGOFR.CloseInviteTimer=[];eGOFR.PollInterval=null;eGOFR.ValueOfExpInterval=null;eGOFR.ActionIdForVD=-1;eGOFR.OfferIntermediateState=false;eGOFR.EventFrms=[];eGOFR.dbgWin=null;eGOFR.VarPlaceHolder="@VAR@";eGOFR.AddToVisitorDashboardCmd="AddtoVisitorDashboard";eGOFR.PollCmd="Poll";eGOFR.StopPollCmd="StopPoll";eGOFR.CLIENT_ELIGIBILITY_MET=1001;eGOFR.OFFER_SHOWN=1004;eGOFR.ACCEPT_ACTION=1005;eGOFR.REJECT_ACTION=1006;eGOFR.IGNORE_ACTION=1007;eGOFR.VISITOR_CONVERTED=1009;eGOFR.EXCEEDED_OFFER_LIMIT=1012;eGOFR.INVITE_DIV_PREFIX="egofrinvite";eGOFR.POLL_INTERVAL=5;eGOFR.POLL_INTERVAL_TIMEOUT=60;eGOFR.VALUE_OF_EXPRESSION_INTERVAL=5;eGOFR.CONDITION_TYPE_TIME_ON_SITE="1001";eGOFR.CONDITION_TYPE_TIME_ON_PAGE="1002";eGOFR.CONDITION_TYPE_TIME_ON_FIELD="1003";eGOFR.CONDITION_TYPE_VALUE_OF_FIELD="1004";eGOFR.CONDITION_TYPE_RFERRER="1005";eGOFR.CONDITION_TYPE_VALUE_OF_EXPRESSION="1006";eGOFR.ACTION_CHAT=1001;eGOFR.ACTION_ADD_VISITOR_FOR_CHAT=1002;eGOFR.ACTION_PHONE=1003;eGOFR.SERVICE_TYPE_CHAT=1001;eGOFR.SERVICE_TYPE_ANALYTIC=1007;eGOFR.RELATIVE_POSITION=1005;eGOFR.AND="1";eGOFR.MAXMILLISECS=1000;eGOFR.CSS_INCLUDE="egofrcssinclude";eGOFR.COOKIE_VALUE_SEPARATOR=";";eGOFR.NO_REOFFER_COOKIE="egofrnoreoffer";eGOFR.REOFFER_IGNORE_COOKIE="egofrreofferignore";eGOFR.REOFFER_ACCEPT_COOKIE="egofrreofferaccept";eGOFR.REOFFER_REJECT_COOKIE="egofrreofferreject";eGOFR.OFFER_COUNT_FOR_SESSION="egofrcountforsession";eGOFR.OFFERS_BEING_SHOWN_COOKIE="egofroffersbeingshown";eGOFR.SERVER_NOT_READY_COOKIE="egofrservernotready";eGOFR.REFERRER_COOKIE="egofrreferrer";eGOFR.SESSION_START_COOKIE="egofrsessionstarttime";eGOFR.COOKIE_TIME_SEPARATOR="|";eGOFR.REOFFER_ON_IGNORE=1;eGOFR.REOFFER_ON_ACCEPT=2;eGOFR.REOFFER_ON_REJECT=3;eGOFR.EVENT_SCR_RECOVERY=60000;eGOFR.ENTRY_POINT_ID_OLD="eglvepid";eGOFR.ENTRY_POINT_ID_NEW="entryPointId";eGOFR.TIME_ON_FIELD="$TOF$";eGOFR.ENABLE_TRACE_LOGGING_UI=false;eGOFR.HEIGHT="height";eGOFR.WIDTH="width";eGOFR.TOP="top";eGOFR.LEFT="left";eGOFR.CLASSNAME_PREFIX="egofr-";eGOFR.HYPHEN="-";eGOFR.BANNER_CONTAINER_NAME="egofr-container";eGOFR.CHAT_VERSION_STRING="&ver=";eGOFR.IsCookiesOrStorageEnabled=true;eGOFR.StorageType=-1;eGOFR.SESSION_TYPE_STORAGE=1;eGOFR.COOKIE_TYPE_STORAGE=2;eGOFR.dbg=(eGOFR.ENABLE_TRACE_LOGGING||eGOFR.ENABLE_TRACE_LOGGING_UI);eGOFR._callHook=function(a){if(typeof a[0]!="function"||a[0]==null){eGOFR.TraceMsg("First argument to _callHook should be of type function & should not be null.");return null}var c=a[0];a=Array.prototype.slice.call(a);var b=c.apply(this,a.slice(1));return b};eGOFR.processHook=function(){return eGOFR._callHook(arguments)};eGOFR.isHookSuccessful=function(){var b=eGOFR._callHook(arguments);if(typeof b!="undefined"&&typeof b.getStatus!="undefined"){if(b.getStatus()<=0){var a=b.getErrorMsg();eGOFR.TraceMsg("Error in hook: "+a);return false}else{return true}}else{eGOFR.TraceMsg("Error in hook: No value returned by hook.");return false}};eGOFR.HookSuccess=function(){return{getErrorMsg:function(){return null},getStatus:function(){return 1}}};eGOFR.HookFailure=function(a){return{_status:0,_errorMsg:a,getErrorMsg:function(){return this._errorMsg},getStatus:function(){return this._status},setErrorMsg:function(b){this._errorMsg=b},setStatus:function(b){this._status=b}}};eGOFR.getConditionsForPage=function(){try{if(eGOFR.isSessionStorageAvailable()){eGOFR.StorageType=eGOFR.SESSION_TYPE_STORAGE}else{if(eGOFR.dbg){eGOFR.TraceMsg("<b>Web storage is disabled</b>")}if(navigator.cookieEnabled){eGOFR.StorageType=eGOFR.COOKIE_TYPE_STORAGE}else{eGOFR.IsCookiesOrStorageEnabled=false;if(eGOFR.dbg){eGOFR.TraceMsg("<b>Web storage and Cookies are disabled</b>")}}}if(eGOFR.IsCookiesOrStorageEnabled){if(eGOFR.GetDomain()!=eGOFR.GetDomain(document.referrer.toString())){eGOFR.SetSessionData(eGOFR.SESSION_START_COOKIE,(new Date()).getTime())}if(typeof eGOFR.SetReferrerEx!="undefined"){eGOFR.processHook(eGOFR.SetReferrerEx)}eGOFR.ResetCookie(eGOFR.OFFERS_BEING_SHOWN_COOKIE);for(condition_key in eGOFR.Conditions){eGOFR.ConditionsSortedArray[eGOFR.Conditions[condition_key].condition_order]=condition_key}eGOFR.addConditionsToPage()}}catch(a){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in getConditionsForPage</b> "+a.description)}}};eGOFR.isSessionStorageAvailable=function(){var a=true;try{sessionStorage.setItem("egofrtest","value");sessionStorage.removeItem("egofrtest")}catch(b){a=false}return a};eGOFR.addConditionsToPage=function(){try{if(eGOFR.PageAccessedTime==-1){eGOFR.PageAccessedTime=(new Date()).getTime()}var evalOnStart=-1;if(typeof(eGOFR.Conditions)!="undefined"&&eGOFR.Conditions!=null){for(var z=0;z<eGOFR.ConditionsSortedArray.length;z++){var condition=eGOFR.Conditions[eGOFR.ConditionsSortedArray[z]];var conditionKey=condition.condition_key;var conditionType=condition.condition_type;var conditionObjectId=condition.condition_operand;var conditionValue=condition.condition_value;var elem=new Array();if(conditionType==eGOFR.CONDITION_TYPE_VALUE_OF_FIELD||conditionType==eGOFR.CONDITION_TYPE_TIME_ON_FIELD){elem[0]=document.getElementById(conditionObjectId);if(!elem[0]||(elem[0]&&elem[0].id!=conditionObjectId)){elem=document.getElementsByName(conditionObjectId)}if(elem.length<=0){if(eGOFR.dbg){eGOFR.TraceMsg("ERROR : Element not found ="+conditionObjectId)}}else{if(eGOFR.Expressions[elem[0].id]!=null&&eGOFR.Expressions[elem[0].id]!="undefined"&&conditionObjectId!=elem[0].id){conditionObjectId=elem[0].id}else{if(eGOFR.Expressions[elem[0].name]!=null&&eGOFR.Expressions[elem[0].name]!="undefined"&&conditionObjectId!=elem[0].name){conditionObjectId=elem[0].name}}}}var expr=eGOFR.PutExpressionStr(condition,conditionObjectId);if(conditionType==eGOFR.CONDITION_TYPE_TIME_ON_SITE){eGOFR.CheckSessionStartTimeCookieAndInitTimer(conditionValue,conditionKey)}else{if(conditionType==eGOFR.CONDITION_TYPE_TIME_ON_PAGE){eGOFR.StartPageTimers(conditionValue,conditionKey)}else{if(conditionType==eGOFR.CONDITION_TYPE_TIME_ON_FIELD){for(i=0;i<elem.length;i++){eGOFR.RegisterEventListener(elem[i],"focus",eGOFR.OnFocusStartTimer);eGOFR.RegisterEventListener(elem[i],"blur",eGOFR.OnBlurCancelTimer)}eGOFR.AddFieldExpression(eGOFR.TIME_ON_FIELD+conditionObjectId,conditionValue,condition.psales_rule_id)}else{if(conditionType==eGOFR.CONDITION_TYPE_VALUE_OF_FIELD){if(evalOnStart==-1){evalOnStart=1}var exp;if(expr!=""){exp=eGOFR.GetExpForCondition(condition.condition_operator,eGOFR.VarPlaceHolder,condition.condition_value,elem[0].type,conditionType)}else{exp="false"}eGOFR.AddFieldExpression(conditionObjectId,exp,condition.psales_rule_id);for(i=0;i<elem.length;i++){if(elem[i]){if(elem[i].type=="select-one"){eGOFR.RegisterEventListener(elem[i],"change",eGOFR.ElementValueChangeListener)}else{if(elem[i].type=="text"){eGOFR.RegisterEventListener(elem[i],"blur",eGOFR.ElementValueChangeListener)}else{if(elem[i].type=="checkbox"||elem[i].type=="radio"){eGOFR.RegisterEventListener(elem[i],"click",eGOFR.ElementValueChangeListener)}}}}else{if(eGOFR.dbg){eGOFR.TraceMsg("Element not found to attach event"+conditionObjectId)}}}}else{if(conditionType==eGOFR.CONDITION_TYPE_VALUE_OF_EXPRESSION){eGOFR.ValueOfExpressions[conditionKey]=expr;if(eGOFR.ValueOfExpInterval==null){try{eGOFR.ValueOfExpInterval=setInterval("eGOFR.CheckValueOfExpression()",eGOFR.VALUE_OF_EXPRESSION_INTERVAL*1000)}catch(e){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in addConditionsToPage while adding a thread</b> "+e.description)}}}else{if(eGOFR.dbg){eGOFR.TraceMsg("addConditionsToPage eGOFR.ValueOfExpInterval is NOT null")}}}else{if(conditionType==eGOFR.CONDITION_TYPE_RFERRER){var expr=eGOFR.GetExpForCondition(condition.condition_operator,"eGOFR.GetReferrerURL()",condition.condition_value,"",conditionType);if(eval(expr)){evalOnStart=0;timer=setTimeout("eGOFR.CheckAndShowInvite('Condition: Referrer')",1000);eGOFR.Timers["referrer"+conditionKey]=timer}}}}}}}}if(evalOnStart==1){window.setTimeout("eGOFR.CheckAndShowInvite('Condition: Value of field')",1000)}}}catch(e){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in addConditionsToPage</b> "+e.description)}}};eGOFR.RegisterEventListener=function(c,a,b){if(c.attachEvent){c.detachEvent("on"+a,b);c.attachEvent("on"+a,b)}else{c.removeEventListener(a,b,true);c.addEventListener(a,b,true)}};eGOFR.AddFieldExpression=function(d,c,b){var a=(typeof eGOFR.Expressions[d]!="undefined")?eGOFR.Expressions[d]:new Array();a[a.length]={ruleId:b,exp:c};eGOFR.Expressions[d]=a};eGOFR.CheckValueOfExpression=function(){if(eGOFR.dbg){eGOFR.TraceMsg("eGOFR.CheckValueOfExpression started")}if(eGOFR.IsSessionValid("eGOFR.CheckValueOfExpression")){for(condition_key in eGOFR.ValueOfExpressions){try{var evaluatedValue=eval(eGOFR.ValueOfExpressions[condition_key]);if(evaluatedValue){window.setTimeout("eGOFR.CheckAndShowInvite('Condition: Value of expression')",10);break}}catch(e){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.CheckValueOfExpression</b> "+e.description)}}}}};eGOFR.GetSourceId=function(c,a){var b=(eGOFR.BrowserTypeIE)?c.srcElement:c.target;return(typeof a!="undefined")?b.name:(b.id!="")?b.id:b.name};eGOFR.ElementValueChangeListener=function(eventSrc){try{var sourceId=eGOFR.GetSourceId(eventSrc);if(typeof eGOFR.Expressions[sourceId]=="undefined"){sourceId=eGOFR.GetSourceId(eventSrc,true)}if(eGOFR.dbg){eGOFR.TraceMsg("Listener invoked for field sourceId="+sourceId)}var obj=(eGOFR.BrowserTypeIE)?eventSrc.srcElement:eventSrc.target;var arr=eGOFR.Expressions[sourceId];for(i=0;i<arr.length;i++){var expr=arr[i].exp;var newExpr=expr.replace(/@VAR@/g,"obj.value");var boolVal=false;if(obj.type!="checkbox"||(obj.type=="checkbox"&&obj.checked==true)){eval("boolVal = "+newExpr)}if(eGOFR.dbg){eGOFR.TraceMsg("Got boolVal= "+boolVal+" newExpr ="+newExpr)}if(boolVal){var proceed=true;var ruleType=eGOFR.Rules[arr[i].ruleId].conjunction_op;if(ruleType==eGOFR.AND&&!eval(eGOFR.BoolExpMapForAnd[arr[i].ruleId])){proceed=false}if(proceed){if(eGOFR.dbg){eGOFR.TraceMsg("Calling for Check and Invite sourceId="+sourceId+" ruleId="+arr[i].ruleId)}window.setTimeout("eGOFR.CheckAndShowInvite('Condition: Value of field')",10);break}}}}catch(e){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.ElementValueChangeListener</b> "+e.description)}}};eGOFR.OnBlurCancelTimer=function(g){try{var d=eGOFR.TIME_ON_FIELD+eGOFR.GetSourceId(g);if(typeof eGOFR.Expressions[d]=="undefined"){d=eGOFR.TIME_ON_FIELD+eGOFR.GetSourceId(g,true)}if(eGOFR.dbg){eGOFR.TraceMsg("OnBlur - Cancelling Timer sourceId="+d)}var a=eGOFR.Expressions[d];var c=eGOFR.Timers[d];for(var b=0;b<c.length;b++){clearTimeout(c[b]);eGOFR.TimeOnFieldMap[d][a[b].ruleId]=false}eGOFR.Timers[d]=null}catch(f){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.OnBlurCancelTimer</b> "+f.description)}}};eGOFR.OnFocusStartTimer=function(g){try{var d=eGOFR.TIME_ON_FIELD+eGOFR.GetSourceId(g);if(typeof eGOFR.Expressions[d]=="undefined"){d=eGOFR.TIME_ON_FIELD+eGOFR.GetSourceId(g,true)}if(eGOFR.dbg){eGOFR.TraceMsg("OnFocus Starting Timer sourceId ="+d)}var b=eGOFR.Expressions[d];var a=(typeof eGOFR.Timers[d]!="undefined"&&eGOFR.Timers[d]!=null)?eGOFR.Timers[d]:new Array();for(var c=0;c<b.length;c++){if(eGOFR.dbg){eGOFR.TraceMsg("Got timeout = "+b[c].exp)}a[a.length]=setTimeout("eGOFR.InitiateTimeOnField('"+d+"',"+b[c].ruleId+")",1000*b[c].exp)}eGOFR.Timers[d]=a}catch(f){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.OnFocusStartTimer</b> "+f.description)}}};eGOFR.InitiateTimeOnField=function(b,a){try{if(eGOFR.dbg){eGOFR.TraceMsg("Initiating Time On Field sourceId="+b+" ruleId="+a)}eGOFR.TimeOnFieldMap[b][a]=true;eGOFR.CheckAndShowInvite("Condition: Time on field")}catch(c){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.InitiateTimeOnField</b> "+c.description)}}};eGOFR.IsVisitorEngaged=function(){var a=null;if(typeof(eGOFR.eGOFRIsVisitorEngagedEx)!="undefined"){a=eGOFR.processHook(eGOFR.eGOFRIsVisitorEngagedEx)}if(!a){a=(eGOFR.Chathandle!=null&&eGOFR.Chathandle.closed==false)?true:false}return a};eGOFR.CanInviteShown=function(a,g){var j=new Object();j.status=false;j.timeOut=eGOFR.REOFFER_IGNORE_INTERVAL;try{if(!eGOFR.IsIntermediateState()&&!eGOFR.IsVisitorEngaged()&&!eGOFR.IsNoReoffer(a)&&!eGOFR.OfferBannerBeingShown(a)){var f=(new Date()).getTime();var b=eGOFR.IsReoffer(eGOFR.REOFFER_ON_IGNORE,a);var c=eGOFR.IsReoffer(eGOFR.REOFFER_ON_ACCEPT,a);var d=eGOFR.IsReoffer(eGOFR.REOFFER_ON_REJECT,a);if(eGOFR.dbg){eGOFR.TraceMsg("ignoreReoffer = "+(f-b)+" currentTime = "+f+" ignoreReoffer="+b);eGOFR.TraceMsg("acceptReoffer = "+(f-c)+" currentTime = "+f+" acceptReoffer="+c);eGOFR.TraceMsg("rejectReoffer = "+d)}if((b==-1&&c==-1&&d==-1)||(b>0&&(f-b)>eGOFR.REOFFER_IGNORE_INTERVAL)||(c>0&&(f-c)>eGOFR.REOFFER_ACCEPTED_INTERVAL)||(d>0)){j.status=true}else{if(g!="undefined"&&(g==eGOFR.CONDITION_TYPE_TIME_ON_SITE||g==eGOFR.CONDITION_TYPE_TIME_ON_PAGE)){if(b>0){j.timeOut=eGOFR.REOFFER_IGNORE_INTERVAL-(f-b)}else{if(c>0){j.timeOut=eGOFR.REOFFER_ACCEPTED_INTERVAL-(f-c)}}}}}else{if(eGOFR.dbg){eGOFR.TraceMsg("Invite can NOT be shown. eGOFR.IsIntermediateState() : "+eGOFR.IsIntermediateState()+", eGOFR.IsNoReoffer: "+eGOFR.IsNoReoffer(a)+", Visitor Engaged flag : "+eGOFR.IsVisitorEngaged()+", eGOFR.OfferBannerBeingShown(offerId) "+eGOFR.OfferBannerBeingShown(a))}j.status=false}}catch(h){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.CanInviteShown</b> "+h.description)}}return j};eGOFR.GetChannelIdFromBannerURL=function(b){try{var d=-1;if(b.indexOf(eGOFR.ENTRY_POINT_ID_NEW)!=-1||b.indexOf(eGOFR.ENTRY_POINT_ID_OLD)!=-1){var a=(b.indexOf(eGOFR.ENTRY_POINT_ID_OLD)==-1)?eGOFR.ENTRY_POINT_ID_NEW:eGOFR.ENTRY_POINT_ID_OLD;var g=b.indexOf(a)+1+a.length;var c=(b.indexOf("&")==-1)?(b.length):(b.indexOf("&",g)==-1)?b.length:b.indexOf("&",g);d=b.substring(g,c)}}catch(f){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.GetChannelIdFromBannerURL</b> "+f.description)}}return d};eGOFR.IsOfferLimitExceeded=function(d){if(eGOFR.dbg){eGOFR.TraceMsg("Checking if offer limit is exceeded for the offer - "+d)}var a=false;if(!eGOFR.Rules[d].is_not_counted_towards_limit){if(eGOFR.IS_OFFERS_LIMIT_PER_SESSION_ENABLE){if(eGOFR.OFFERS_LIMIT_PER_SESSION>-1){var c=eGOFR.GetSessionData(eGOFR.OFFER_COUNT_FOR_SESSION);if(c!=""){var b=parseInt(c.substring(c.indexOf(eGOFR.COOKIE_VALUE_SEPARATOR)+1,c.length-1));if(eGOFR.OFFERS_LIMIT_PER_SESSION<=b){a=true;if(eGOFR.dbg){eGOFR.TraceMsg("<b>Offer limit ("+b+")is exceeded for the offer - "+d+" ignoring the offer.</b>")}var e=new Array();eGOFR.LogEvent(eGOFR.EXCEEDED_OFFER_LIMIT,eGOFR.EXCEEDED_OFFER_LIMIT,eGOFR.SessionId,0,d,eGOFR.Rules[d].contenturl_key,e)}}}}}return a};eGOFR.CheckAndShowInvite=function(d){try{if(eGOFR.dbg){eGOFR.TraceMsg("Check and Invite for Proactive Sales. Message "+d)}var b=eGOFR.EvalAllConditions();if(typeof eGOFR.PostUIConditionEvaluation!="undefined"){b.value=eGOFR.processHook(eGOFR.PostUIConditionEvaluation,b.value)}if(!b.value&&!(typeof eGOFR.PostUIConditionNotMet!="undefined"&&eGOFR.processHook(eGOFR.PostUIConditionNotMet))){return}else{var c=b.ruleId;if(eGOFR.CanInviteShown(c).status){eGOFR.SetIntermediateState(true,c);var j=new Array();j[j.length]="EVPARAM_condition_met";j[j.length]=b.conditionIds;j[j.length]="egofferreferrerurl";j[j.length]=eGOFR.processHook(eGOFR.GetReferrerEx);eGOFR.LogEvent(eGOFR.CLIENT_ELIGIBILITY_MET,eGOFR.CLIENT_ELIGIBILITY_MET,eGOFR.SessionId,0,c,eGOFR.Rules[c].contenturl_key,j);if(eGOFR.Rules[c].service_type_key!=eGOFR.SERVICE_TYPE_ANALYTIC){var h=eGOFR.GetBannerIdByAB(c);var a=eGOFR.GetChannelIdFromBannerURL(eGOFR.Banners[h].url);if(eGOFR.Rules[c].server_side_check){eGOFR.ServerSideCheck(a,eGOFR.Rules[c].service_type_key,h,eGOFR.Rules[c].offertype_key,c,b.conditionIds)}else{var g={status:true,checkValue:true,bannerId:h,offerType:eGOFR.Rules[c].offertype_key,ruleId:c,conditionsMet:b.conditionIds};eGOFR.OnServerSideCheck(g)}}else{for(conditionKey in eGOFR.Conditions){if(eGOFR.Conditions[conditionKey].psales_rule_id==c&&eGOFR.Conditions[conditionKey].condition_type==eGOFR.CONDITION_TYPE_VALUE_OF_EXPRESSION){eGOFR.ValueOfExpressions[conditionKey]=false}}eGOFR.SetIntermediateState(false,c);if(eGOFR.dbg){eGOFR.TraceMsg("eGOFR.CheckAndShowInvite Rule : "+c+" is in Analytic mode.")}}}}}catch(f){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.CheckAndShowInvite</b> "+f.description)}}};eGOFR.OnServerSideCheck=function(a){try{if(eGOFR.dbg){eGOFR.TraceMsg("Got the server side check. Status = "+a.checkValue)}if(a.status){if(a.checkValue){if(a.offerType==eGOFR.ACTION_ADD_VISITOR_FOR_CHAT){eGOFR.SetIntermediateState(false,a.ruleId);if(eGOFR.PollInterval==null&&eGOFR.ActionIdForVD==-1){eGOFR.ActionIdForVD=a.bannerId;if(eGOFR.dbg){eGOFR.TraceMsg("Adding visitor to the dashboard.  Cconditions Met are : "+a.conditionsMet)}eGOFR.CreateInteractionSession(a.bannerId,a.offerType,a.ruleId,a.conditionsMet,1)}else{if(eGOFR.dbg){eGOFR.TraceMsg("POLLING CANNOT BE STARTED AS THERE IS ONE THREAD ALREADY RUNNING")}}}else{eGOFR.CreateInteractionSession(a.bannerId,a.offerType,a.ruleId,a.conditionsMet,0)}}else{eGOFR.ResetTimersForOffer(a.ruleId,"retryservercheck");eGOFR.SetIntermediateState(false,a.ruleId);eGOFR.SetServerNotReadyCookie(a.ruleId);eGOFR.CheckAndShowInvite("Re-evaluating conditions for other rules after serverside check has returned false")}}else{eGOFR.SetIntermediateState(false,a.ruleId)}}catch(b){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.OnServerSideCheck</b> "+b.description)}}};eGOFR.CreateInteractionSession=function(p,l,m,r,c){try{if(eGOFR.dbg){eGOFR.TraceMsg("eGOFR.CreateInteractionSession bannerid"+p+" ruleid "+m)}if(!(typeof eGOFR.PreCreateInteractionEx!="undefined"&&eGOFR.PreCreateInteractionEx(p,l,m,r,c))){var o=document.location.href;var b=r;var q="Session Information";var d=eGOFR.Rules[m].service_type_key;var n=eGOFR.GetChannelIdFromBannerURL(eGOFR.Banners[p].url);var h=document.title;var k="1";var g=new Array();g[g.length]="service_condition";g[g.length]=b;g[g.length]="referrer_url";g[g.length]=eGOFR.processHook(eGOFR.GetReferrerEx);g[g.length]="visitor_session_information";g[g.length]=q;g[g.length]="servicetype_key";g[g.length]=d;g[g.length]="channel_id";g[g.length]=n;g[g.length]="session_key";g[g.length]=eGOFR.SessionId;g[g.length]="interaction_type";g[g.length]=c;g[g.length]="bannerid";g[g.length]=p;g[g.length]="rule_id";g[g.length]=m;g[g.length]="content_url_id";g[g.length]=eGOFR.Rules[m].contenturl_key;g[g.length]="designContextId";g[g.length]=eGOFR.Rules[m].design_context_id;if(l==eGOFR.ACTION_ADD_VISITOR_FOR_CHAT&&typeof EGAINCLOUD!="undefined"&&EGAINCLOUD.Account.getAllIds){var a=EGAINCLOUD.Account.getAllIds();g[g.length]="cust_account_id";g[g.length]=a.a;g[g.length]="visitor_session_id";g[g.length]=a.s;g[g.length]="visitor_user_id";g[g.length]=a.u}if(typeof(eGOFR.SetVDAdditionalInformationEx)!="undefined"){eGOFR.processHook(eGOFR.SetVDAdditionalInformationEx,g)}var f=eGOFR.ServletURL+"?command="+eGOFR.AddToVisitorDashboardCmd;for(i=0;i<g.length;i=i+2){f+="&"+g[i]+"="+g[i+1]}eGOFR.SubmitToServer(eGOFR.EncodeURI(f),"eGOFR.OnAddVisitorToDashboard")}if(typeof eGOFR.PostCreateInteractionEx!="undefined"){eGOFR.PostCreateInteractionEx(p,l,m,r,c)}}catch(j){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.CreateInteractionSession</b> "+j.description)}}};eGOFR.OnAddVisitorToDashboard=function(a){try{if(a.status){if(a.interactionId>0){eGOFR.IsFirstInteraction=false}if(typeof a.interactionType!="undefined"&&a.interactionType==0){if(eGOFR.dbg){eGOFR.TraceMsg("eGOFR.OnAddVisitorToDashboard bannerid"+a.bannerId+" ruleid "+a.interactionId)}eGOFR.OpenInvitationDiv(a.bannerId,a.interactionId)}else{if(eGOFR.ActionIdForVD!=-1){if(eGOFR.dbg){eGOFR.TraceMsg("Visitor added to dashboard successfully. Session Id "+a.sessionId)}eGOFR.SendNextPoll(a.interactionId)}}}else{}}catch(b){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.OnAddVisitorToDashboard</b> "+b.description)}}};eGOFR.PollcallBack=function(a){try{if(eGOFR.dbg){eGOFR.TraceMsg("Poll callBack. Status "+a.pollStatus+" Agentid : "+a.agentId+" InteractionId : "+a.interactionId+" timestamp="+new Date())}clearTimeout(eGOFR.PollInterval);if(a.status){if(a.pollStatus&&a.stopPoll!=true){eGOFR.OpenInvitationDiv(eGOFR.ActionIdForVD,a.interactionId,true,a.agentId);eGOFR.PollInterval=null;eGOFR.ActionIdForVD=-1}else{if(!eGOFR.IsMultipleOfferAllowed&&eGOFR.IsIntermediateState()){if(eGOFR.PollInterval!=null&&eGOFR.ActionIdForVD!=-1){eGOFR.PollInterval=null;eGOFR.ActionIdForVD=-1;eGOFR.StopPoll(a.interactionId)}}else{if(eGOFR.IsSessionValid("eGOFR.PollcallBack")){eGOFR.PollInterval=setTimeout("eGOFR.SendNextPoll("+a.interactionId+")",eGOFR.POLL_INTERVAL*1000)}}}}}catch(b){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.PollcallBack</b> "+b.description)}}};eGOFR.SendNextPoll=function(d,b){try{clearTimeout(eGOFR.PollInterval);var b=(typeof b!="undefined")?"&retry="+b:"";var a=eGOFR.ServletURL+"?command="+eGOFR.PollCmd+"&session_id="+d+b;eGOFR.SubmitToServer(eGOFR.EncodeURI(a),"eGOFR.PollcallBack");eGOFR.PollInterval=setTimeout("eGOFR.SendNextPoll("+d+",true)",eGOFR.POLL_INTERVAL_TIMEOUT*1000)}catch(c){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in sendNextPoll</b> "+c.description)}}};eGOFR.StopPoll=function(c){try{var b=eGOFR.ServletURL+"?command="+eGOFR.StopPollCmd+"&interaction_id="+c;eGOFR.SubmitToServer(eGOFR.EncodeURI(b),"eGOFR.PollcallBack")}catch(a){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in StopPoll</b> "+a.description)}}};eGOFR.CheckSessionStartTimeCookieAndInitTimer=function(b,a){try{var f=null;sessionStartTime=eGOFR.GetSessionData(eGOFR.SESSION_START_COOKIE);if(sessionStartTime!=null&&sessionStartTime!=""){var c=((1000*b)-((new Date()).getTime()-sessionStartTime))+50;if(c>0){f=window.setTimeout("eGOFR.checkAndTriggerEvaluation('"+a+"')",c)}else{f=window.setTimeout("eGOFR.checkAndTriggerEvaluation('"+a+"')",2000)}}else{eGOFR.SetSessionData(eGOFR.SESSION_START_COOKIE,(new Date()).getTime());f=window.setTimeout("eGOFR.checkAndTriggerEvaluation('"+a+"')",b*1000+50)}eGOFR.Timers["tos"+a]=f}catch(d){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.CheckSessionStartTimeCookieAndInitTimer</b> "+d.description)}}};eGOFR.StartPageTimers=function(c,a){var b=((1000*c)-((new Date()).getTime()-eGOFR.PageAccessedTime))+50;eGOFR.Timers["top"+a]=setTimeout("eGOFR.checkAndTriggerEvaluation('"+a+"')",(b>0)?b:500);eGOFR.RegisterEventListener(document,"beforeunload",eGOFR.OnBlurCancelTimer)};eGOFR.checkAndTriggerEvaluation=function(d){var g=false;var e=eGOFR.Conditions[d].psales_rule_id;var c=-1;var b=eGOFR.Conditions[d].condition_type;var f=(b==eGOFR.CONDITION_TYPE_TIME_ON_SITE)?"tos":(b==eGOFR.CONDITION_TYPE_TIME_ON_PAGE)?"top":(b==eGOFR.CONDITION_TYPE_RFERRER)?"referrer":"";if(eGOFR.dbg){eGOFR.TraceMsg("<b>eGOFR.checkAndTriggerEvaluation ="+e+"</b>")}if(!eGOFR.IsNoReoffer(e)){if(eGOFR.IsIntermediateState()){if(eGOFR.dbg){eGOFR.TraceMsg("intermediate state offerId ="+e+" conditionKey="+f+d)}c=eGOFR.INVITE_AUTO_CLOSE_INTERVAL+1000}else{if(eGOFR.IsVisitorEngaged()){if(eGOFR.dbg){eGOFR.TraceMsg("engaged state offerId ="+e+" conditionKey="+f+d)}c=eGOFR.REOFFER_ACCEPTED_INTERVAL+1000}else{var a=eGOFR.CanInviteShown(e,eGOFR.Conditions[d].condition_type);if(!a.status){if(eGOFR.dbg){eGOFR.TraceMsg("ReOffer Waiting to eligible: OfferId  ="+e+" conditionKey="+f+d)}c=a.timeOut+1000}else{g=true;if(eGOFR.dbg){eGOFR.TraceMsg("Show reoffer offerId ="+e)}}}}}else{if(eGOFR.dbg){eGOFR.TraceMsg("Is no reoffer offerId ="+e)}}if(g){eGOFR.CheckAndShowInvite("Condition: Time on site/page")}else{if(c!=-1){var h=window.setTimeout("eGOFR.checkAndTriggerEvaluation('"+d+"')",c+1000);if(f!=""){eGOFR.Timers[f+d]=h}}}};eGOFR.GetDomain=function(c){var f="";try{if(typeof c=="undefined"){f=window.location.hostname}else{var b=c.indexOf(":");if(b<0){b=0}f=c.substring(b+3,c.length);b=f.indexOf("/");if(b<0){b=f.length}f=f.substring(0,b)}var d=f.indexOf(":");if(d!=-1){f=f.substring(0,d)}var a=f.split(".");if(a.length>=1){a.splice(0,1)}f=a.join(".")}catch(g){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.GetDomain</b> "+g.description)}}return f};eGOFR.OpenInvitationDiv=function(p,g,q,b){try{if(eGOFR.dbg){eGOFR.TraceMsg("Opening Invite bannerid "+p+" interactionId "+g)}var h=eGOFR.Banners[p];h.interactionId=g;var o=h.psales_rule_id;var a=eGOFR.Rules[o].offertype_key;var d=h.template_keys;var f=eGOFR.Templates[d].location;var m=eGOFR.INVITE_DIV_PREFIX+p;divElem=document.getElementById(m);if(divElem==null){eGOFR.AddInviteDivsToPage("","",p,o,b,f)}if(((q&&eGOFR.CanInviteShown(o).status)||((!q)&&(!eGOFR.IsVisitorEngaged())))&&((h.style_key==eGOFR.RELATIVE_POSITION&&document.getElementById(h.relative_element_id)!=null)||h.style_key!=eGOFR.RELATIVE_POSITION)){var s=eGOFR.Templates[d].csspath;var j=eGOFR.CSS_INCLUDE;if(eGOFR.IsMultipleOfferAllowed){j=j+d}eGOFR.AddNewCSS(j,s,p,f);eGOFR.SetIntermediateState(true,o);var m=eGOFR.INVITE_DIV_PREFIX+p;divElem=document.getElementById(m);if(typeof(divElem)!="undefined"&&divElem!=null){eGOFR.setBannerPosition(divElem,p,f);divElem.style.visibility="visible";var c=eGOFR.Rules[o].is_fixed;if(typeof c=="undefined"||c==false){eGOFR.CloseInviteTimer[p]=window.setTimeout("eGOFR.CloseInvitationDiv("+eGOFR.IGNORE_ACTION+","+p+","+o+")",eGOFR.INVITE_AUTO_CLOSE_INTERVAL)}var r=new Array();r[r.length]="EVPARAM_banner_id";r[r.length]=p;if(!eGOFR.Rules[o].is_not_counted_towards_limit){var n=eGOFR.GetSessionData(eGOFR.OFFER_COUNT_FOR_SESSION);if(n==""){var k=1}else{k=parseInt(n.substring(n.indexOf(eGOFR.COOKIE_VALUE_SEPARATOR)+1,n.length-1));k++;eGOFR.RemoveCookieEntry(eGOFR.OFFER_COUNT_FOR_SESSION,""+(k-1))}if(eGOFR.dbg){eGOFR.TraceMsg("<b>Offer limit count increased to "+k+" for ruleId "+o+"</b>")}eGOFR.SetOfferCount(k)}eGOFR.LogEvent(eGOFR.OFFER_SHOWN,eGOFR.OFFER_SHOWN,eGOFR.SessionId,g,o,eGOFR.Rules[o].contenturl_key,r);if(typeof(eGOFR.postOpenInvitationDivEx)!="undefined"){eGOFR.processHook(eGOFR.postOpenInvitationDivEx,p,q,b,divElem)}}else{eGOFR.SetIntermediateState(false,o);if(eGOFR.dbg){eGOFR.TraceMsg("Failed to show invite")}}}else{eGOFR.SetIntermediateState(false,o);if(eGOFR.dbg){if(h.style_key==eGOFR.RELATIVE_POSITION&&document.getElementById(h.relative_element_id)==null){eGOFR.TraceMsg("Relative element object is undefined.Invite can NOT be shown.")}else{eGOFR.TraceMsg("Invite can NOT be shown.")}}}}catch(l){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.OpenInvitationDiv</b> "+l.description)}}};eGOFR.setBannerPosition=function(b,o,g){var j=true;if(typeof(eGOFR.preSetBannerPositionEx)!="undefined"){j=eGOFR.isHookSuccessful(eGOFR.preSetBannerPositionEx,b,o)}if(j){var k=eGOFR.Banners[o];if(k.style_key==eGOFR.RELATIVE_POSITION){var q=k.relative_element_id;try{var l=document.getElementById(q);if(l==null){l=document.getElementsByName(q)?document.getElementsByName(q)[0]:null}var p=eGOFR.getAbsolutePos(l);var f=p.y;var n=p.x;var c=b.getElementsByTagName("div")[0];c.style.position="absolute";c.style.left=(parseFloat(n)+parseFloat(k.relative_left_position))+"px";c.style.top=(parseFloat(f)+parseFloat(k.relative_top_position))+"px";if(typeof k.z_index!="undefined"){c.style.zIndex=parseInt(k.z_index)}}catch(m){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.setBannerPosition while positioning the banner</b> "+m.description)}}}else{if(typeof k.z_index!="undefined"){var h=eGOFR.BANNER_CONTAINER_NAME.replace(eGOFR.CLASSNAME_PREFIX,eGOFR.CLASSNAME_PREFIX+g+eGOFR.HYPHEN);var a=document.getElementById(h);if(a==null){a=(document.getElementById(eGOFR.INVITE_DIV_PREFIX+o)).getElementsByTagName("div")[0];var d=a.className;d=d.replace(g+eGOFR.HYPHEN,"");a.className=d}a.position="absolute";a.style.zIndex=parseInt(k.z_index)}}}if(typeof(eGOFR.postSetBannerPositionEx)!="undefined"){eGOFR.processHook(eGOFR.postSetBannerPositionEx,b,o)}};eGOFR.LogARIEvent=function(c,b,a,d){var e=new Array();e[e.length]="EVPARAM_banner_id";e[e.length]=b;eGOFR.LogEvent(c,c,eGOFR.SessionId,d,a,eGOFR.Rules[a].contenturl_key,e)};eGOFR.CloseInvitationDiv=function(f,d,b){try{var g=true;if(typeof(eGOFR.preCloseInvitationDivEx)!="undefined"){g=eGOFR.isHookSuccessful(eGOFR.preCloseInvitationDivEx,f,d,b)}if(g){if(eGOFR.dbg){eGOFR.TraceMsg("Closeing Invite bannerid="+d+" reason="+f+" ruleId="+b)}window.clearTimeout(eGOFR.CloseInviteTimer[d]);eGOFR.SetIntermediateState(false,b);divElem=document.getElementById(eGOFR.INVITE_DIV_PREFIX+d);var a=eGOFR.Banners[d];if(typeof(divElem)!="undefined"){divElem.style.visibility="hidden"}eGOFR.LogARIEvent(f,d,b,a.interactionId);if(f==eGOFR.IGNORE_ACTION){eGOFR.SetReofferCookie(eGOFR.REOFFER_ON_IGNORE,b);eGOFR.ResetTimersForOffer(b,"ignore")}}if(typeof(eGOFR.postCloseInvitationDivEx)!="undefined"){eGOFR.processHook(eGOFR.postCloseInvitationDivEx,f,d,b)}}catch(c){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.CloseInvitationDiv</b> "+c.description)}}};eGOFR.OnReject=function(d,c,a){try{var g=true;if(typeof(eGOFR.preOnRejectEx)!="undefined"){g=eGOFR.isHookSuccessful(eGOFR.preOnRejectEx,d,c,a)}if(g){var f=eGOFR.Rules[a].reoffer_on_reject;if(!f){eGOFR.SetNoReoffer(a)}else{eGOFR.SetReofferCookie(eGOFR.REOFFER_ON_REJECT,a)}eGOFR.CloseInvitationDiv(d,c,a)}if(typeof(eGOFR.postOnRejectEx)!="undefined"){eGOFR.processHook(eGOFR.postOnRejectEx,d,c,a)}}catch(b){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.OnReject </b>"+b.description)}}};eGOFR.OnAccept=function(k,j,c){try{var f=true;if(typeof(eGOFR.preOnAcceptEx)!="undefined"){f=eGOFR.isHookSuccessful(eGOFR.preOnAcceptEx,k,j,c)}if(f){var g=eGOFR.Banners[k];var a=eGOFR.Rules[j].offertype_key;var d=eGOFR.Rules[j].is_fixed;var b=eGOFR.Banners[k].url;var l=eGOFR.Rules[j].reoffer_on_accept;if(!l){eGOFR.SetNoReoffer(j)}else{eGOFR.SetReofferCookie(eGOFR.REOFFER_ON_ACCEPT,j)}if(typeof d=="undefined"||d==false){eGOFR.CloseInvitationDiv(eGOFR.ACCEPT_ACTION,k,j);if(l){eGOFR.ResetTimersForOffer(j,"accept")}}else{eGOFR.LogARIEvent(eGOFR.ACCEPT_ACTION,k,j,g.interactionId)}if(a==eGOFR.ACTION_CHAT||a==eGOFR.ACTION_ADD_VISITOR_FOR_CHAT){eGOFR.StartChat(g,c,g.interactionId)}else{if(a==eGOFR.ACTION_PHONE){eGOFR.StartClickToCall(g)}else{eGOFR.StartOtherChannel(g)}}}if(typeof(eGOFR.postOnAcceptEx)!="undefined"){eGOFR.processHook(eGOFR.postOnAcceptEx,k,j,c)}}catch(h){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.OnAccept </b>"+h.description)}}};eGOFR.ReplaceInternalData=function(f,b,l,j,k,a,h,c,d){try{k=k.replace(/\<bannerid\>/gi,l);k=k.replace(/\<ruleid\>/gi,j);k=k.replace(/\<bannertext\>/gi,a);if(typeof h!="undefined"){h=h.replace(eGOFR.CLASSNAME_PREFIX,eGOFR.CLASSNAME_PREFIX+d+eGOFR.HYPHEN);k=k.replace(/\<styleclassname\>/gi,h)}else{k=k.replace(/\<styleclassname\>/gi,"")}if(typeof c!="undefined"){k=k.replace(/\<agentid\>/gi,c)}else{k=k.replace(/\<agentid\>/gi,-1)}return k}catch(g){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.ReplaceInternalData</b> "+g.description)}}};eGOFR.GetBannerIdByAB=function(h){var k=eGOFR.Rules[h].bannerids;var d=k[0];var f=eGOFR.Banners[d].ab_test_share;var b=k[0];try{var a=eGOFR.MAXMILLISECS*f/100;var j=(new Date()).getMilliseconds();var c=(j<=a)?0:1;b=k[c]}catch(g){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.GetBannerIdByAB</b> "+g.description)}}return b};eGOFR.AddInviteDivsToPage=function(h,a,o,m,b,d){try{if(eGOFR.dbg){eGOFR.TraceMsg("Added invite div HTML to the page. But it is not visible now. bannerid : "+o)}var f=eGOFR.INVITE_DIV_PREFIX+o;var k=document.getElementById(f);if(!k){var p;p=document.createElement("div");p.id=f;p.style.visibility="hidden";document.body.appendChild(p);k=document.getElementById(f);var c=eGOFR.Banners[o].template_keys;var g=eGOFR.Banners[o].text;var l=eGOFR.Banners[o].class_name;var n=eGOFR.Templates[c].innerhtml;n=eGOFR.ReplaceInternalData(h,a,o,m,n,g,l,b,d);if(typeof eGOFR.ReplacePlaceHoldersEx!="undefined"){n=eGOFR.processHook(eGOFR.ReplacePlaceHoldersEx,n)}k.innerHTML=n}}catch(j){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.AddInviteDivsToPage</b> "+j.description)}}};eGOFR.PutExpressionStr=function(condition,objId){try{var retValue="";var conditionKey=condition.condition_key;var conditionType=condition.condition_type;var conditionObjectId=condition.condition_operand;var conditionValue=condition.condition_value;var conditionOperator=condition.condition_operator;var ruleType=eGOFR.Rules[condition.psales_rule_id].conjunction_op;var ruleId=eGOFR.Rules[condition.psales_rule_id].rule_id;if(conditionType==eGOFR.CONDITION_TYPE_TIME_ON_SITE){retValue="( (new Date()).getTime() - eGOFR.GetSessionData(eGOFR.SESSION_START_COOKIE) )"+conditionOperator+(conditionValue*1000)}else{if(conditionType==eGOFR.CONDITION_TYPE_TIME_ON_PAGE){var curTime=(new Date()).getTime();retValue="( (new Date()).getTime() - "+curTime+" )"+conditionOperator+(conditionValue*1000)}else{if(conditionType==eGOFR.CONDITION_TYPE_TIME_ON_FIELD){objId=eGOFR.TIME_ON_FIELD+objId;retValue='eGOFR.TimeOnFieldMap["'+objId+'"]['+ruleId+"]";if(typeof eGOFR.TimeOnFieldMap[objId]=="undefined"){eGOFR.TimeOnFieldMap[objId]=new Array()}eGOFR.TimeOnFieldMap[objId][ruleId]=false}else{if(conditionType==eGOFR.CONDITION_TYPE_VALUE_OF_FIELD){var ele=document.getElementById(conditionObjectId);if(ele&&ele.id==conditionObjectId){retValue=eGOFR.GetExpForCondition(conditionOperator,'document.getElementById("'+conditionObjectId+'")',condition.condition_value,ele.type,conditionType)}else{var ele=document.getElementsByName(conditionObjectId);if(ele&&ele.length>0){retValue="(";for(i=0;i<ele.length;i++){retValue+=eGOFR.GetExpForCondition(conditionOperator,'document.getElementsByName("'+conditionObjectId+'")['+i+"]",condition.condition_value,ele[i].type,conditionType);if(i!=ele.length-1){retValue+=" || "}}retValue+=")"}else{try{if(eval(conditionObjectId)){var ele=eval(conditionObjectId);retValue=eGOFR.GetExpForCondition(conditionOperator,'eval("'+conditionObjectId+'")',condition.condition_value,ele.type,conditionType)}}catch(err){}}}}else{if(conditionType==eGOFR.CONDITION_TYPE_VALUE_OF_EXPRESSION){retValue=eGOFR.GetExpForCondition(conditionOperator,conditionObjectId,condition.condition_value,"",conditionType)}else{if(conditionType==eGOFR.CONDITION_TYPE_RFERRER){retValue=eGOFR.GetExpForCondition(conditionOperator,"eGOFR.GetReferrerURL()",condition.condition_value,"",conditionType)}}}}}}var tempRetValue=retValue;if(tempRetValue==""){tempRetValue="false"}if(ruleType==eGOFR.AND){var boolExp=eGOFR.BoolExpMapForAnd[ruleId];if(typeof boolExp!="undefined"){eGOFR.BoolExpMapForAnd[ruleId]=boolExp+" && "+tempRetValue;eGOFR.AllConditionsForRule[ruleId]=eGOFR.AllConditionsForRule[ruleId]+","+conditionKey}else{eGOFR.BoolExpMapForAnd[ruleId]=tempRetValue;eGOFR.AllConditionsForRule[ruleId]=conditionKey}}else{eGOFR.BoolExpMapForOr[conditionKey]=tempRetValue}if(eGOFR.dbg){eGOFR.TraceMsg("In eGOFR.PutExpressionStr ruleId= "+ruleId+" Got retValue="+tempRetValue)}return retValue}catch(e){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.PutExpressionStr </b>"+e.description)}}};eGOFR.GetExpForCondition=function(b,f,c,h,e){var a=false;var g;var d;var j=f;if(e==eGOFR.CONDITION_TYPE_VALUE_OF_FIELD&&f!=eGOFR.VarPlaceHolder){f=f+".value"}if(b==">"||b=="<"||b==">="||b=="<="||b=="=="||b=="!="){g=parseInt(c);g=isNaN(g)?'"'+c+'"':g}else{g='"'+c+'"';a=true}if(!a){d=f+b+g}else{if(b=="contains"){d=f+".indexOf("+g+") != -1"}else{if(b=="notcontains"){d=f+' != "" && '+f+".indexOf("+g+") == -1"}else{if(b=="beginswith"){d=f+".indexOf("+g+") == 0"}else{if(b=="endswith"){d="("+f+".lastIndexOf("+g+") != -1) && (("+f+".lastIndexOf("+g+")) + "+g+".length == "+f+".length )"}}}}}if(typeof h!="undefined"&&(h=="checkbox"||h=="radio")&&j!=eGOFR.VarPlaceHolder){d="("+j+".checked == true && "+d+")"}return d};eGOFR.GetReferrerURL=function(){return(typeof(eGOFR.GetReferrerEx)!="undefined")?eGOFR.processHook(eGOFR.GetReferrerEx):document.referrer};eGOFR.IsServerNotReady=function(c){var a=false;var b=(new Date()).getTime();var d=eGOFR.GetServerNotReadyCookie(c);if(eGOFR.dbg){var e=(d>0)?(b-d):0;eGOFR.TraceMsg("eGOFR.IsServerNotReady serverNotReadyCookie = "+e+" currentTime = "+b+" ruleId="+c)}if(d>0){if((b-d)<eGOFR.RETRY_SERVER_CHECK_INTERVAL){a=true}else{eGOFR.RemoveCookieEntry(eGOFR.SERVER_NOT_READY_COOKIE,""+c+eGOFR.COOKIE_TIME_SEPARATOR)}}if(eGOFR.dbg){eGOFR.TraceMsg("eGOFR.IsServerNotReady Rule id is : "+c+" retFlag is : "+a)}return a};eGOFR.EvalAllConditions=function(){try{var evalObj=new Object();evalObj.value=false;evalObj.conditionIds=-1;evalObj.ruleId=-1;for(var i=0;i<eGOFR.ConditionsSortedArray.length;i++){var condId=eGOFR.ConditionsSortedArray[i];var ruleId=eGOFR.Rules[eGOFR.Conditions[condId].psales_rule_id].rule_id;var ruleType=eGOFR.Rules[ruleId].conjunction_op;if(eGOFR.dbg){eGOFR.TraceMsg("Evaluating Condition Id is : "+condId+" Rule id is : "+ruleId+" Rule Type is : "+ruleType)}var conditionEvalStr=(ruleType==eGOFR.AND)?eGOFR.BoolExpMapForAnd[ruleId]:eGOFR.BoolExpMapForOr[condId];try{if(eval(conditionEvalStr)){if(!eGOFR.IsNoReoffer(ruleId)&&!eGOFR.OfferBannerBeingShown(ruleId)&&!eGOFR.IsServerNotReady(ruleId)&&!eGOFR.isPollingInProgress(ruleId)){if(!eGOFR.IsOfferLimitExceeded(ruleId)){evalObj.value=true;evalObj.ruleId=ruleId;evalObj.conditionIds=(ruleType==eGOFR.AND)?eGOFR.AllConditionsForRule[ruleId]:condId;if(eGOFR.dbg){eGOFR.TraceMsg("Conditions evaluated for the rule id = "+ruleId)}break}}else{if(eGOFR.dbg){eGOFR.TraceMsg("eGOFR.EvalAllConditions: Ignoring offer id = "+ruleId)}}}}catch(e){if(ruleType==eGOFR.AND){break}}}return evalObj}catch(e){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.</b>EvalAllConditions "+e.description)}}};eGOFR.isPollingInProgress=function(b){var a=false;if(eGOFR.Rules[b].offertype_key==eGOFR.ACTION_ADD_VISITOR_FOR_CHAT){if((eGOFR.PollInterval!=null)&&(eGOFR.ActionIdForVD!=-1)){a=true}}return a};eGOFR.OfferBannerBeingShown=function(b){var c=false;var a=eGOFR.GetSessionData(eGOFR.OFFERS_BEING_SHOWN_COOKIE);if((eGOFR.IsMultipleOfferAllowed&&a.indexOf(eGOFR.COOKIE_VALUE_SEPARATOR+b+eGOFR.COOKIE_VALUE_SEPARATOR)!=-1)){c=true}if(eGOFR.dbg){eGOFR.TraceMsg("eGOFR.OfferBannerBeingShown: Offer id = "+b+" retVal = "+c)}return c};eGOFR.IsIntermediateState=function(){return(!eGOFR.IsMultipleOfferAllowed&&eGOFR.OfferIntermediateState)};eGOFR.SetIntermediateState=function(a,b){eGOFR.OfferIntermediateState=a;if(eGOFR.IsMultipleOfferAllowed){if(a){eGOFR.AddCookieEntry(eGOFR.OFFERS_BEING_SHOWN_COOKIE,b)}else{eGOFR.RemoveCookieEntry(eGOFR.OFFERS_BEING_SHOWN_COOKIE,""+b)}}if(eGOFR.dbg){eGOFR.TraceMsg("eGOFR.SetIntermediateState "+a)}};eGOFR.AddNewCSS=function(g,c){var a=false;try{var b=document.getElementById(g);if(b!=null){if(!eGOFR.IsMultipleOfferAllowed){eGOFR.RemoveScriptElement(g);b=null}}if(b==null){var d=document.getElementsByTagName("head")[0];b=document.createElement("link");b.id=g;b.type="text/css";b.rel="stylesheet";d.appendChild(b);b.href=c;a=true}}catch(f){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.AddNewCSS</b> "+f.description)}}return a};eGOFR.RemoveScriptElement=function(d){try{var b=document.getElementsByTagName("head")[0];var a=document.getElementById(d);if(a){b.removeChild(a)}}catch(c){if(eGOFR.dbg){eGOFR.TraceMsg("<b>Error in eGOFR.RemoveScriptElement</b> "+c.description)}}};eGOFR.LogEvent=function(k,b,h,d,f,c,e){if(!(typeof eGOFR.PreLogEventEx!="undefined"&&eGOFR.PreLogEventEx(k,b,h,d,f,c,e))){var a=eGOFR.ServletURL+"?command=LogEvent";a=a+"&pservicesessionid="+h;a=a+"&interactionid="+d;a=a+"&stageid="+k;a=a+"&eventtype="+b;if(f!=-1){a=a+"&offerId="+f;a=a+"&designContextId="+eGOFR.Rules[f].design_context_id}if(c!=-1){a=a+"&contentUrlId="+c}if(typeof e!="undefined"&&e.length>1){var j=e.length;for(var g=0;g<j-1;g=g+2){a=a+"&"+e[g]+"="+e[g+1]}}eGOFR.SubmitToServer(a)}if(typeof eGOFR.PostLogEventEx!="undefined"){eGOFR.PostLogEventEx(k,b,h,d,f,c,e)}};eGOFR.IsSessionValid=function(a){var b=false;if(eGOFR.IsCookiesOrStorageEnabled){var c=(new Date()).getTime();if(eGOFR.PageAccessedTime+eGOFR.MAXIMUM_TIME_ON_PAGE_IN_MILLISECONDS>c){b=true}else{if(eGOFR.ValueOfExpInterval!=null){window.clearInterval(eGOFR.ValueOfExpInterval);eGOFR.ValueOfExpInterval=null}if(eGOFR.PollInterval!=null){window.clearInterval(eGOFR.PollInterval);eGOFR.PollInterval=null}if(eGOFR.dbg){eGOFR.TraceMsg("<b>Offer Session has expired. Page accessed at "+eGOFR.PageAccessedTime+", current time is "+c+", Maximum time on page in miliseconds is "+eGOFR.MAXIMUM_TIME_ON_PAGE_IN_MILLISECONDS+", Function called "+a+"</b>")}}}return b};eGOFR.SubmitToServer=function(b,h){if(eGOFR.IsSessionValid("eGOFR.SubmitToServer")){var a="submittoserver";var g=-1;for(var d=0;d<eGOFR.EventFrms.length;d++){if(eGOFR.EventFrms[d].used==false){g=d;break}}var e=null;var c=false;if(g==-1){g=eGOFR.EventFrms.length;eGOFR.EventFrms[g]=new Object();c=true}else{eGOFR.RemoveScriptElement(a+g);c=true}if(c){var f=document.getElementsByTagName("head")[0];e=document.createElement("script");e.id=a+g;e.type="text/javascript";f.appendChild(e)}else{e=document.getElementById(a+g)}eGOFR.EventFrms[g].callback=(typeof h!="undefined")?h:null;eGOFR.EventFrms[g].timer=window.setTimeout("eGOFR.RecoverScript("+g+")",eGOFR.EVENT_SCR_RECOVERY);eGOFR.EventFrms[g].used=true;e.src=b+"&ts="+(new Date()).getTime()+"&reqid="+g;if(eGOFR.dbg){eGOFR.TraceMsg("Used frame = "+g)}}};eGOFR.CallCallback=function(scriptId,result){if(eGOFR.EventFrms[scriptId].callback!=null){eval(eGOFR.EventFrms[scriptId].callback)(result)}eGOFR.EventFrms[scriptId].used=false;window.clearTimeout(eGOFR.EventFrms[scriptId].timer);if(eGOFR.dbg){eGOFR.TraceMsg("In CallCallback for = "+scriptId)}};eGOFR.RecoverScript=function(a){eGOFR.EventFrms[a].used=false;eGOFR.EventFrms[a].callback=null;eGOFR.EventFrms[a].timer=null;if(eGOFR.dbg){eGOFR.TraceMsg("In eGOFR.RecoverScript for ="+a)}};eGOFR.TraceMsg=function(a){try{if(eGOFR.dbgWin==null||eGOFR.dbgWin.closed){eGOFR.dbgWin=window.open("","egofrdebug");window.setTimeout("eGOFR.TraceMsg('"+a+"')",1000)}else{eGOFR.dbgWin.document.write(new Date()+" -> "+a+"<BR>")}}catch(b){}};eGOFR.GetSessionData=function(a){if(eGOFR.StorageType==eGOFR.SESSION_TYPE_STORAGE){if(eGOFR.isSessionStorageAvailable()){return eGOFR.GetValueFromSessionStorage(a)}else{eGOFR.IsCookiesOrStorageEnabled=false;if(eGOFR.dbg){eGOFR.TraceMsg("<b>Web storage is disabled</b>")}}}else{if(eGOFR.StorageType==eGOFR.COOKIE_TYPE_STORAGE){if(navigator.cookieEnabled){return eGOFR.GetCookie(a)}else{eGOFR.IsCookiesOrStorageEnabled=false;if(eGOFR.dbg){eGOFR.TraceMsg("<b>Cookies are disabled</b>")}}}}};eGOFR.SetSessionData=function(b,c,a){if(eGOFR.StorageType==eGOFR.SESSION_TYPE_STORAGE){if(eGOFR.isSessionStorageAvailable()){eGOFR.SetValueInSessionStorage(b,c)}else{eGOFR.IsCookiesOrStorageEnabled=false;if(eGOFR.dbg){eGOFR.TraceMsg("<b>Web storage is disabled</b>")}}}else{if(eGOFR.StorageType==eGOFR.COOKIE_TYPE_STORAGE){if(navigator.cookieEnabled){eGOFR.SetCookie(b,c,a)}else{eGOFR.IsCookiesOrStorageEnabled=false;if(eGOFR.dbg){eGOFR.TraceMsg("<b>Cookies are disabled</b>")}}}}};eGOFR.GetValueFromSessionStorage=function(a){var b=unescape(sessionStorage.getItem(a));if(b==null||b=="null"){b=""}return b};eGOFR.SetValueInSessionStorage=function(a,b){sessionStorage.setItem(a,escape(b))};eGOFR.GetCookie=function(a){if(document.cookie.length>0){c_start=document.cookie.indexOf(a+"=");if(c_start!=-1){c_start=c_start+a.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1){c_end=document.cookie.length}return unescape(document.cookie.substring(c_start,c_end))}}return""};eGOFR.SetCookie=function(b,d,a){var e=new Date();e.setDate(e.getDate()+a);var f=b+"="+escape(d)+((a==null||typeof a=="undefined")?"":";expires="+e.toGMTString());f+=";path=/";var c=eGOFR.GetDomain();if(c!=""){f+=";domain="+c}document.cookie=f};eGOFR.EncodeURI=function(a){var f=a.indexOf("?");if(f==-1){return encodeURI(a)}else{var b=a.substring(0,f);var e=a.substring(f+1,a.length);var k=e.split("&");var d=encodeURI(b);var h=null;var j;var g;for(i=0;i<k.length;i++){h=k[i];var c=h.split("=");if(c.length>0){j=c[0];g=c[1];if(i==0){d=d.concat("?",j,"=",encodeURIComponent(g))}else{d=d.concat("&",j,"=",encodeURIComponent(g))}}else{j=c[0];if(i==0){d=d.concat("?",j)}else{d=d.concat("&",j)}}}return d}};eGOFR.StartClickToCall=function(d){var f="";var a=d.url;if(typeof EGAINCLOUD!="undefined"&&EGAINCLOUD.Account.getAllIds){var c=EGAINCLOUD.Account.getAllIds();f="&aId="+c.a+"&sId="+c.s+"&uId="+c.u}var e=window.EG_CALL_Q||[];e.push(["enableTracker",true]);a=a+"&ofrsessionid="+eGOFR.SessionId+"&interactionid="+d.interactionId+f;if(typeof d.is_new_window!="undefined"&&d.is_new_window=="true"){var b=eGOFR.getWHTL(d,false,false)+"resizable=yes,scrollbars=yes,toolbar=no,location=no,menubar=0";window.open(a,"",b)}else{document.location.href=a}};eGOFR.StartOtherChannel=function(b){if(typeof b.is_new_window!="undefined"&&b.is_new_window=="true"){var a=eGOFR.getWHTL(b,false,false)+"resizable=yes,scrollbars=yes,toolbar=no,location=no,menubar=0";window.open(b.url,"",a)}else{document.location.href=b.url}};eGOFR.StartChat=function(j,d,g){try{if(eGOFR.Chathandle!=null&&eGOFR.Chathandle.closed==false){eGOFR.Chathandle.focus();return}}catch(h){}var c=j.url;var o="";o=encodeURIComponent(o);var l=encodeURIComponent(document.location.href);var e=l.lastIndexOf("#");if(e!=-1){l=l.substring(0,e)}var p="";if(typeof EGAINCLOUD!="undefined"&&EGAINCLOUD.Account.getAllIds){var a=EGAINCLOUD.Account.getAllIds();p="&aId="+a.a+"&sId="+a.s+"&uId="+a.u}var m=window.EG_CALL_Q||[];m.push(["enableTracker",true]);var n=(d==-1)?"":"&eglvpreferredagent="+d;var b=c+"&ofrsessionid="+eGOFR.SessionId+"&interactionid="+g+p+"&eglvrefname="+o+n;if((b+l).length<=2000){b+="&referer="+l}if(typeof j.is_new_window!="undefined"&&j.is_new_window=="true"){var k=eGOFR.getWHTL(j,true,(c.indexOf(eGOFR.ENTRY_POINT_ID_OLD)!=-1));if(c.indexOf(eGOFR.CHAT_VERSION_STRING)>-1){b+="&"+k.replace(/,/gm,"&")}var f=k+"resizable=yes,scrollbars=yes,toolbar=no";eGOFR.Chathandle=window.open(b,"",f)}else{document.location.href=b}};eGOFR.ExtractAttribute=function(e){var d=new Array();var c;if((c=e.indexOf("?"))>0){var a=e.substring(c+1).split("&");for(c=0;c<a.length;c++){var b=a[c].split("=");if(b.length==2&&(b[0]==eGOFR.WIDTH||b[0]==eGOFR.HEIGHT||b[0]==eGOFR.TOP||b[0]==eGOFR.LEFT)){d[b[0]]=b[1];if(eGOFR.dbg){eGOFR.TraceMsg("attrib[] ="+d[b[0]]+" arr2[0]="+b[0])}}}}return d};eGOFR.getWHTL=function(e,h,c){var d=true;var f="";var k=-1;var g=e.url.indexOf(this.CHAT_VERSION_STRING)>-1;if(typeof(preGetWHTLEx)!="undefined"){d=preGetWHTLEx(e,h,c)}var b=0;if(typeof e.window_width!="undefined"){b=parseInt(e.window_width)}if(b>0){f+="width="+(b)+","}else{if(h){if(c){k=(window.screen)?(window.screen.availWidth==800)?(window.screen.availWidth*41/100):(window.screen.availWidth*31/100):630;f+="width="+(k)+","}else{if(!g){f+="width=600,"}}}}var l=0;if(typeof e.window_height!="undefined"){l=parseInt(e.window_height)}if(l>0){f+="height="+(l)+","}else{if(h){if(c){f+="height="+((window.screen)?window.screen.availHeight*95/100:400)+","}else{if(!g){f+="height=600,"}}}}var a=0;if(typeof e.window_top_position!="undefined"){a=parseInt(e.window_top_position)}if(a>0){f+="top="+(a)+","}else{if(h){if(c){f+="top=0,"}else{if(!g){f+="top=100,"}}}}var j=0;if(typeof e.window_left_position!="undefined"){j=parseInt(e.window_left_position)}if(j>0){f+="left="+(j)+","}else{if(h){if(c){if(k==-1){k=(window.screen)?(window.screen.availWidth==800)?(window.screen.availWidth*41/100):(window.screen.availWidth*31/100):630}f+="left="+((window.screen)?(window.screen.availWidth-k)*98/100:0)+","}else{if(!g){f+="left=100,"}}}}if(typeof(postGetWHTLEx)!="undefined"){postGetWHTLEx(e,h,c)}return f};eGOFR.ServerSideCheck=function(c,g,f,b,e,a){var d=eGOFR.ServletURL+"?command=Check&partitionId="+eGOFR.PartitionId+"&serviceId="+c+"&serviceType="+g+"&actionId="+f+"&offerType="+b+"&ruleId="+e+"&egoffermetconditions="+a;d+="&pservicesessionid="+eGOFR.SessionId;d+="&contentUrlId="+eGOFR.Rules[e].contenturl_key;d+="&designContextId="+eGOFR.Rules[e].design_context_id;d=eGOFR.AddAttribsForServiceType(d,g,f);eGOFR.SubmitToServer(eGOFR.EncodeURI(d),"eGOFR.OnServerSideCheck")};eGOFR.AddAttribsForServiceType=function(a,d,c){if(d==eGOFR.SERVICE_TYPE_CHAT){a+="&templateType=";a+=(eGOFR.Banners[c].url.indexOf(eGOFR.ENTRY_POINT_ID_NEW)!=-1)?"1":"2";var b=eGOFR.getParameterFromURL(eGOFR.Banners[c].url,"video");if(b!=null){a+="&videoChat="+b}}return a};eGOFR.PostConversionEventX=function(f,c,e){var a=-1;var d=-1;var b;if(typeof f!="undefined"&&f>0){b=eGOFR.Banners[f];d=b.interactionId;c=b.psales_rule_id;a=eGOFR.Rules[c].contenturl_key}else{if(typeof c!="undefined"&&c>0){a=eGOFR.Rules[c].contenturl_key}else{c=-1}}eGOFR.LogEvent(eGOFR.VISITOR_CONVERTED,eGOFR.VISITOR_CONVERTED,eGOFR.SessionId,d,c,a,e)};eGOFR.SetNoReoffer=function(a){eGOFR.AddCookieEntry(eGOFR.NO_REOFFER_COOKIE,a)};eGOFR.SetOfferCount=function(a){eGOFR.AddCookieEntry(eGOFR.OFFER_COUNT_FOR_SESSION,a)};eGOFR.IsNoReoffer=function(b){var c=false;var a=eGOFR.GetSessionData(eGOFR.NO_REOFFER_COOKIE);if(a.indexOf(eGOFR.COOKIE_VALUE_SEPARATOR+b+eGOFR.COOKIE_VALUE_SEPARATOR)!=-1){c=true}if(eGOFR.dbg){eGOFR.TraceMsg("eGOFR.IsNoReoffer: Offer id = "+b+" retVal = "+c)}return c};eGOFR.IsReoffer=function(e,g){var c=-1;if(e==eGOFR.REOFFER_ON_IGNORE||e==eGOFR.REOFFER_ON_ACCEPT||e==eGOFR.ACCEPT_ACTION||e==eGOFR.IGNORE_ACTION){var b=(e==eGOFR.REOFFER_ON_IGNORE||e==eGOFR.IGNORE_ACTION)?eGOFR.GetSessionData(eGOFR.REOFFER_IGNORE_COOKIE):eGOFR.GetSessionData(eGOFR.REOFFER_ACCEPT_COOKIE);var f=eGOFR.COOKIE_VALUE_SEPARATOR+g+eGOFR.COOKIE_TIME_SEPARATOR;if(b.indexOf(f)!=-1){var d=b.substring(b.indexOf(f)+f.length,b.length);d=d.substring(0,d.indexOf(eGOFR.COOKIE_VALUE_SEPARATOR));var a=d.indexOf(eGOFR.COOKIE_TIME_SEPARATOR);if(a>0){d=d.substring(0,a)}c=parseInt(d)}}else{if(e==eGOFR.REOFFER_ON_REJECT||e==eGOFR.REJECT_ACTION){var b=eGOFR.GetSessionData(eGOFR.REOFFER_REJECT_COOKIE);if(b.indexOf(eGOFR.COOKIE_VALUE_SEPARATOR+g+eGOFR.COOKIE_VALUE_SEPARATOR)!=-1){c=1}}}return c};eGOFR.GetServerNotReadyCookie=function(e){var b=-1;var a=eGOFR.GetSessionData(eGOFR.SERVER_NOT_READY_COOKIE);var d=eGOFR.COOKIE_VALUE_SEPARATOR+e+eGOFR.COOKIE_TIME_SEPARATOR;if(a.indexOf(d)!=-1){var c=a.substring(a.indexOf(d)+d.length,a.length);c=c.substring(0,c.indexOf(eGOFR.COOKIE_VALUE_SEPARATOR));b=parseInt(c)}return b};eGOFR.SetServerNotReadyCookie=function(a){eGOFR.RemoveCookieEntry(eGOFR.SERVER_NOT_READY_COOKIE,""+a+eGOFR.COOKIE_TIME_SEPARATOR);var b=""+a+eGOFR.COOKIE_TIME_SEPARATOR+(new Date()).getTime();eGOFR.AddCookieEntry(eGOFR.SERVER_NOT_READY_COOKIE,b)};eGOFR.GetReofferCount=function(d,g){var f=0;var b,e;if(d==eGOFR.REOFFER_ON_ACCEPT){b=eGOFR.GetSessionData(eGOFR.REOFFER_ACCEPT_COOKIE)}else{if(d==eGOFR.REOFFER_ON_REJECT){b=eGOFR.GetSessionData(eGOFR.REOFFER_REJECT_COOKIE)}else{if(d==eGOFR.REOFFER_ON_IGNORE){b=eGOFR.GetSessionData(eGOFR.REOFFER_IGNORE_COOKIE)}else{return f}}}e=eGOFR.COOKIE_VALUE_SEPARATOR+g+eGOFR.COOKIE_TIME_SEPARATOR;if(b.indexOf(e)!=-1){var c=b.substring(b.indexOf(e)+e.length,b.length);c=c.substring(0,c.indexOf(eGOFR.COOKIE_VALUE_SEPARATOR));if(c.length>0){var a=c.lastIndexOf(eGOFR.COOKIE_TIME_SEPARATOR);f=parseInt(c.substring(a+1))}}if(eGOFR.dbg){eGOFR.TraceMsg("eGOFR.GetReofferCount: Offer id = "+g+" type = "+d+" reofferCount = "+f+" entries = "+b)}return f};eGOFR.SetReofferCookie=function(g,j){var c,b,a,e;e=true;a=eGOFR.GetReofferCount(g,j);if(g==eGOFR.REOFFER_ON_IGNORE){b=eGOFR.REOFFER_IGNORE_COOKIE;c=""+j+eGOFR.COOKIE_TIME_SEPARATOR+(new Date()).getTime();eGOFR.RemoveCookieEntry(eGOFR.REOFFER_IGNORE_COOKIE,""+j+eGOFR.COOKIE_TIME_SEPARATOR);if(eGOFR.Rules[j].is_max_reoffer_ignore){if(eGOFR.Rules[j].max_reoffer_ignore>a){a++;c=c+eGOFR.COOKIE_TIME_SEPARATOR+a}else{e=false}}var d=eGOFR.GetReofferCount(eGOFR.REOFFER_ON_ACCEPT,j);eGOFR.RemoveCookieEntry(eGOFR.REOFFER_ACCEPT_COOKIE,""+j+eGOFR.COOKIE_TIME_SEPARATOR);if(eGOFR.Rules[j].is_max_reoffer_accept){var h=""+j+eGOFR.COOKIE_TIME_SEPARATOR+"-1"+eGOFR.COOKIE_TIME_SEPARATOR+d;eGOFR.AddCookieEntry(eGOFR.REOFFER_ACCEPT_COOKIE,h)}}else{if(g==eGOFR.REOFFER_ON_ACCEPT){b=eGOFR.REOFFER_ACCEPT_COOKIE;c=""+j+eGOFR.COOKIE_TIME_SEPARATOR+(new Date()).getTime();eGOFR.RemoveCookieEntry(b,""+j+eGOFR.COOKIE_TIME_SEPARATOR);if(eGOFR.Rules[j].is_max_reoffer_accept){if(eGOFR.Rules[j].max_reoffer_accept>a){a++;c=c+eGOFR.COOKIE_TIME_SEPARATOR+a}else{e=false}}var f=eGOFR.GetReofferCount(eGOFR.REOFFER_ON_IGNORE,j);eGOFR.RemoveCookieEntry(eGOFR.REOFFER_IGNORE_COOKIE,""+j+eGOFR.COOKIE_TIME_SEPARATOR);if(eGOFR.Rules[j].is_max_reoffer_ignore){var h=""+j+eGOFR.COOKIE_TIME_SEPARATOR+"-1"+eGOFR.COOKIE_TIME_SEPARATOR+f;eGOFR.AddCookieEntry(eGOFR.REOFFER_IGNORE_COOKIE,h)}}else{if(g==eGOFR.REOFFER_ON_REJECT){b=eGOFR.REOFFER_REJECT_COOKIE;c=""+j;eGOFR.RemoveCookieEntry(b,""+j);if(g==eGOFR.REOFFER_ON_REJECT&&eGOFR.Rules[j].is_max_reoffer_reject){if(eGOFR.Rules[j].max_reoffer_reject>a){a++;c=c+eGOFR.COOKIE_TIME_SEPARATOR+a}else{e=false}}}}}if(e){eGOFR.AddCookieEntry(b,c)}else{eGOFR.SetNoReoffer(j)}if(eGOFR.dbg){eGOFR.TraceMsg("eGOFR.SetReofferCookie: Offer id = "+j+" setReofferCookie = "+e+" name = "+b+" val = "+c)}};eGOFR.RmReofferCookieEntry=function(a){eGOFR.RemoveCookieEntry(eGOFR.REOFFER_IGNORE_COOKIE,""+a+eGOFR.COOKIE_TIME_SEPARATOR);eGOFR.RemoveCookieEntry(eGOFR.REOFFER_ACCEPT_COOKIE,""+a+eGOFR.COOKIE_TIME_SEPARATOR);eGOFR.RemoveCookieEntry(eGOFR.REOFFER_REJECT_COOKIE,""+a)};eGOFR.RemoveCookieEntry=function(d,f){var b=eGOFR.GetSessionData(d);if(b.indexOf(f)!=-1){var a=b.split(eGOFR.COOKIE_VALUE_SEPARATOR);var e=new Array();var c=0;for(i=0;i<a.length;i++){if(a[i].indexOf(f)==-1&&a[i]!=""){e[c++]=a[i]}}var g=e.join(eGOFR.COOKIE_VALUE_SEPARATOR);if(g!=""){eGOFR.SetSessionData(d,eGOFR.COOKIE_VALUE_SEPARATOR+g+eGOFR.COOKIE_VALUE_SEPARATOR)}else{eGOFR.SetSessionData(d,"")}}};eGOFR.ResetCookie=function(b){var a=eGOFR.GetSessionData(b);if(a!=""){eGOFR.SetSessionData(b,"")}};eGOFR.AddCookieEntry=function(b,c){var a=eGOFR.GetSessionData(b);if(a==null||a==""){eGOFR.SetSessionData(b,eGOFR.COOKIE_VALUE_SEPARATOR+c+eGOFR.COOKIE_VALUE_SEPARATOR)}else{eGOFR.SetSessionData(b,a+c+eGOFR.COOKIE_VALUE_SEPARATOR)}if(eGOFR.dbg){eGOFR.TraceMsg("After eGOFR.AddCookieEntry name= "+b+" val = "+eGOFR.GetSessionData(b))}};eGOFR.ResetTimersForOffer=function(d,c){if(eGOFR.dbg){eGOFR.TraceMsg(" In ResetTimersForOffer for type "+c+" ruleId="+d)}var g;for(var b=0;b<eGOFR.ConditionsSortedArray.length;b++){g=eGOFR.ConditionsSortedArray[b];var a=eGOFR.Conditions[g].condition_type;if(eGOFR.Conditions[g].psales_rule_id==d){if(a==eGOFR.CONDITION_TYPE_TIME_ON_SITE||a==eGOFR.CONDITION_TYPE_TIME_ON_PAGE){var f=(a==eGOFR.CONDITION_TYPE_TIME_ON_SITE)?"tos":"top";clearTimeout(eGOFR.Timers[f+g]);if(eGOFR.dbg){eGOFR.TraceMsg("Remove timer for "+f+g)}}else{if(a==eGOFR.CONDITION_TYPE_RFERRER){clearTimeout(eGOFR.Timers["referrer"+g]);if(eGOFR.dbg){eGOFR.TraceMsg("Remove timer for referrer "+g)}}}}}var e=(c=="accept")?eGOFR.REOFFER_ACCEPTED_INTERVAL:(c=="retryservercheck")?eGOFR.RETRY_SERVER_CHECK_INTERVAL:eGOFR.REOFFER_IGNORE_INTERVAL;window.setTimeout("eGOFR.SetTimersForOffer("+d+")",(e+1000))};eGOFR.SetTimersForOffer=function(c){var a;var d;for(var b=0;b<eGOFR.ConditionsSortedArray.length;b++){d=eGOFR.ConditionsSortedArray[b];a=eGOFR.Conditions[d].condition_type;if(eGOFR.Conditions[d].psales_rule_id==c){if(a==eGOFR.CONDITION_TYPE_TIME_ON_SITE){eGOFR.CheckSessionStartTimeCookieAndInitTimer(eGOFR.Conditions[d].condition_value,eGOFR.Conditions[d].condition_key);if(eGOFR.dbg){eGOFR.TraceMsg("Added timer for TOS "+d+" ruleId="+c)}}else{if(a==eGOFR.CONDITION_TYPE_TIME_ON_PAGE){eGOFR.StartPageTimers(eGOFR.Conditions[d].condition_value,eGOFR.Conditions[d].condition_key);if(eGOFR.dbg){eGOFR.TraceMsg("Added timer for TOP "+d+" ruleId="+c)}}else{if(eGOFR.dbg){eGOFR.TraceMsg("Got condition type "+a+" for key "+d+" ruleId="+c)}window.setTimeout("eGOFR.checkAndTriggerEvaluation('"+d+"')",1000)}}}}};eGOFR.getAbsolutePos=function(e){var k=navigator.userAgent;var d=k.match(/firefox/i);var c=d&&(k.match(/firefox\/2./i)||k.match(/firefox\/1./i));var f=d&&!c;var j=new Object();j.x=0;j.y=0;if(e!==null){j.x=e.offsetLeft;j.y=e.offsetTop;var b=e.offsetParent;var g=e.parentNode;var a=null;while(b!=null){j.x+=b.offsetLeft;j.y+=b.offsetTop;var h=b.tagName.toLowerCase();if((eGOFR.BrowserTypeIE&&h!="table")||(f&&h=="td")){a=eGOFR.getBorderWidth(b);j.x+=a.left;j.y+=a.top}if(b!=document.body&&b!=document.documentElement){j.x-=b.scrollLeft;j.y-=b.scrollTop}if(!eGOFR.BrowserTypeIE){while(b!=g&&g!==null){j.x-=g.scrollLeft;j.y-=g.scrollTop;if(c){a=eGOFR.getBorderWidth(g);j.x+=a.left;j.y+=a.top}g=g.parentNode}}g=b.parentNode;b=b.offsetParent}}return j};eGOFR.parseBorderWidth=function(b){var a=0;if(typeof(b)=="string"&&b!=null&&b!=""){var c=b.indexOf("px");if(c>=0){a=parseInt(b.substring(0,c))}else{a=1}}return a};eGOFR.getBorderWidth=function(c){var b=new Object();b.left=0;b.top=0;b.right=0;b.bottom=0;if(window.getComputedStyle){var a=window.getComputedStyle(c,null);b.left=parseInt(a.borderLeftWidth.slice(0,-2));b.top=parseInt(a.borderTopWidth.slice(0,-2));b.right=parseInt(a.borderRightWidth.slice(0,-2));b.bottom=parseInt(a.borderBottomWidth.slice(0,-2))}else{b.left=eGOFR.parseBorderWidth(c.style.borderLeftWidth);b.top=eGOFR.parseBorderWidth(c.style.borderTopWidth);b.right=eGOFR.parseBorderWidth(c.style.borderRightWidth);b.bottom=eGOFR.parseBorderWidth(c.style.borderBottomWidth)}return b};eGOFR.getParameterFromURL=function(b,a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)").exec(b);return c?c[1]:null};window.setTimeout("eGOFR.getConditionsForPage()",1000);