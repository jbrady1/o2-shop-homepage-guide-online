var EGAINCLOUD;EGAINCLOUD||function(h,g){function D(a){return a?(a^16*Math.random()>>a/4).toString(16):([1E7]+-1E3+-4E3+-8E3+-1E11).replace(/[018]/g,D)}function r(){if(!0!==y&&(y=!0,clearTimeout(E),0<s.length))for(var a=0;a<s.length;a++)b.App.inject(s[a])}function t(a){return a.replace(/^\s+|\s+$/g,"")}function j(a){return!(!a||/^\s*$/.test(a))}function K(){-1!==z&&(E=h.setTimeout(function(){r()},1E3*z))}var b={},y,o="",m="",k="",A=null,u,v,w,s=[],E,B=!1,p=!1,n=null,C=!1,i=!1,z=1,F,G,H,I=!1,J=!1,q=!0,x=!0,L={setCustomAttr:"addToCustomBuffer",setUserID:"setUID",enableTracker:"setTrackerFlag",trackPageView:"handleTrackerEvent",disableTrackOnLoad:"delayTrackerEvent",loadOffers:"handleOffersLoadEvent",disableOffersOnLoad:"delayOffersLoadEvent",unloadOffers:"handleOffersUnloadEvent"};b.init=function(a){if(a&&(a.domain&&(A=a.domain),a.aId&&(o=a.aId),m=b.Cookie.get("EG-S-ID"),k=b.Cookie.get("EG-U-ID"),B=j(a.delayLoad)&&(!0===a.delayLoad||"true"===a.delayLoad),a.delayLoadTime&&(z=a.delayLoadTime),b.Account.isValid()&&a.apps&&0<a.apps.length)){for(var d=0;d<a.apps.length;d++){var c=a.apps[d];j(c.name)&&/analytics/i.test(c.name)?b.Cookie.isCookieSupported()?(C=!0,i=j(c.partial)&&(!0===c.partial||"true"===c.partial),b.Tracker.processArrayQ(),I||b.Tracker.sendNavCheck()):(q=!1,b.Tracker.processArrayQ()):B?s[d-1]=c:b.App.inject(c)}B&&(a=g.isEGFIF?h.parent.document:g,a="loaded"===a.readyState||"complete"===a.readyState?!0:!1,a?r():(a=g.isEGFIF?h.parent:h,a.addEventListener?a.addEventListener("load",r,!1):a.attachEvent("onload",r),K()))}};b.isWinLoaded=function(){return!0===y};b.Cookie={set:function(a,b,c,e,f,l){g.cookie=a+"="+escape(b)+(null==e?"":"; expires="+e.toGMTString())+(null==c?"":"; path="+c)+(null==f?"":"; domain="+f)+(!0==l?"; secure":"")},get:function(a){for(var a=a+"=",b=g.cookie.split(";"),c=0;c<b.length;c++){for(var e=b[c];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(a))return unescape(e.substring(a.length,e.length))}return null},isCookieSupported:function(){if(!1===navigator.cookieEnabled)return!1;if(!g.cookie){g.cookie="testcookie=1";if(!g.cookie)return!1;g.cookie="testcookie=; expires="+(new Date(0)).toUTCString()}return!0}};b.Storage={isStorageSupported:function(){try{return sessionStorage.setItem("egtest","egtest"),sessionStorage.removeItem("egtest"),!0}catch(a){return!1}},set:function(a,b,c){try{("user"==c?localStorage:sessionStorage).setItem(a,b)}catch(e){}},get:function(a,b){var a=a.split(","),c=[];try{for(var e,f,g="user"==b?localStorage:sessionStorage,h=0;h<a.length;h++)e=a[h],f=g.getItem(e),c.push(f)}catch(i){}return 1<c.length?c:c[0]},remove:function(a,b){a=a.split(",");try{for(var c,e="user"==b?localStorage:sessionStorage,f=0;f<a.length;f++)c=a[f],e.removeItem(c)}catch(g){}}};b.Cache={set:function(a,d,c,e){if(!e&&b.Storage.isStorageSupported())b.Storage.set(a,d,c);else switch(c){case "session":b.Cookie.set(a,d,"/");break;case "user":c=new Date,c.setDate(c.getDate()+365),b.Cookie.set(a,d,"/",c)}},get:function(a){return b.Cookie.get(a)}};b.guid=function(){return"eg"+(1073741824*Math.random()).toString(16).replace(".","")};b.uuid=function(){return D()};b.randomPrefix=function(){return["A","B","C","D","E"][Math.floor(5*Math.random())]+Math.floor(10*Math.random())};b.Account={isValid:function(){if(A)for(var a=A.split(","),b=0,c=a.length;b<c;b++)if(RegExp(t(a[b]).replace("*",""),"i").test(g.URL))return!0;return!1},getId:function(a){switch(a){case "account":return o;case "session":return m;case "user":return k}},getAllIds:function(){return{a:o,s:m,u:k}}};b._callback={};b.App={inject:function(a){var d=g.isEGFIF?h.parent.document:g,c=d.getElementsByTagName("script")[0],e=d.createElement("script");if(j(a.code))try{e.appendChild(d.createTextNode(a.code))}catch(f){e.text=a.code}else if(j(a.codePath))e.src=a.codePath;else if(j(a.webServer)){var d=t(a.webServer),l=j(a.contextRoot)?t(a.contextRoot):"system",i=j(a.protocol)&&!/both/i.test(a.protocol)?t(a.protocol)+":":"";if(j(a.name)){if(/offers/i.test(a.name)){b.Cookie.isCookieSupported()||b.Storage.isStorageSupported()?(F=i+"//"+d+"/"+l,J||b.Offers.inject()):x=!1;return}/cobrowse/i.test(a.name)?(e.id="_egainallowcobrowse",e.src=i+"//"+d+"/"+l+"/cb/admin/js/allow_cobrowse.js"):/socialsales/i.test(a.name)?(e.id="_egainallowcobrowse",e.src=i+"//"+d+"/"+l+"/cb/admin/js/allow_cobrowse.js"):/assistedsales/i.test(a.name)&&(e.id="_egainallowcobrowse",e.src=i+"//"+d+"/"+l+"/cb/admin/js/allow_cobrowse.js",a.name="offers",b.App.inject(a))}}c.parentNode.insertBefore(e,c)}};b.Offers={inject:function(a){var d=g.isEGFIF?h.parent.document:g,c=d.getElementsByTagName("script")[0],e=d.createElement("script"),f=a&&a.title||d.title,a=a&&a.page||d.URL;b.Offers.matchURL(a)&&(e.id="eGainOffers",e.src=F+"/Offers.egain?command=GetRulesJS&egofferpageurl="+a+"&egofferpagetitle="+f+"&egofferpatternchecksum="+encodeURIComponent(b.Offers.getPatternCheckSum()),c.parentNode.insertBefore(e,c))},getStorageType:function(){return"local"==b.Storage.get("eGOFRStorage","user")?"user":"session"},getPatternCheckSum:function(){return b.Storage.get("eGOFRPatternsChecksum",b.Offers.getStorageType())||""},matchURL:function(a){if(b.Storage.isStorageSupported()){var d=g.isEGFIF?h.parent:h;d.eGOFRPatternStore||(d.eGOFRPatternStore=function(a,c,d,e){b.Storage.set("eGOFRStorage",a,"user");b.Storage.set("eGOFRPatterns",c,b.Offers.getStorageType());b.Storage.set("eGOFRPatternsExpSec",d,b.Offers.getStorageType());b.Storage.set("eGOFRPatternsChecksum",e,b.Offers.getStorageType());b.Storage.set("eGOFRPatternsSetTime",(new Date).getTime()+"",b.Offers.getStorageType())});if(!b.Offers.getPatternCheckSum())return!0;var d=(new Date).getTime(),c=b.Storage.get("eGOFRPatternsExpSec",b.Offers.getStorageType()),e=b.Storage.get("eGOFRPatternsSetTime",b.Offers.getStorageType()),c=isNaN(c)?"0":c,e=isNaN(e)?"0":e,c=1E3*parseInt(c,10),e=parseInt(e,10);if(0>d-e||d-e>c)return b.Storage.remove("eGOFRPatternsChecksum",b.Offers.getStorageType()),!0;if(d=b.Storage.get("eGOFRPatterns",b.Offers.getStorageType())){d=d.split("$EGOFR$");for(e=0;e<d.length;++e)if(RegExp(d[e]).test(a))return!0}return!1}return!0}};b.Server={jsonp:function(a,d){var c=b.guid(),e=g.getElementsByTagName("script")[0],f=g.createElement("script"),a=a+((-1<a.indexOf("?")?"&":"?")+"_cb_=EGAINCLOUD._callback."+c);if(2E3<a.length)throw Error("JSONP only support a maximum of 2000 bytes of input.");b._callback[c]=function(a){d&&d(a);delete b._callback[c];f.parentNode.removeChild(f)};f.onerror=function(){if(c in b._callback)b._callback[c]({error:"load-error: unknown"})};var h=function(){setTimeout(function(){if(c in b._callback)f.onerror()},0)};f.addEventListener?f.addEventListener("load",h,!1):f.onreadystatechange=function(){/loaded|complete/.test(this.readyState)&&h()};f.src=a;e.parentNode.insertBefore(f,e)}};b.Tracker={_customBuffer:[],getBaseURL:function(){return"https://cloud-emea.analytics-egain.com/tracker?"+(o?"aId="+o:"")+(m?"&sId="+m:"")+(k?"&uId="+k:"")},getIframeURL:function(){return"https://analytics.analytics-egain.com/iframe/"+o},handleTrackerEvent:function(a){!1!==q&&b.Tracker.sendNavCheck("tracker",a)},delayTrackerEvent:function(){!1!==q&&(I=!0)},handleOffersLoadEvent:function(a){if(!1!==x){b.Tracker.handleOffersUnloadEvent();var d=g.getElementById("eGainOffers");d&&d.parentNode.removeChild(d);b.Offers.inject(a)}},delayOffersLoadEvent:function(){!1!==x&&(J=!0)},handleOffersUnloadEvent:function(){if(!1!==x){var a=g.isEGFIF?h.parent:h;a.eGOFR&&a.eGOFR.unloadOffers&&a.eGOFR.unloadOffers()}},handleChatEvent:function(a){!1!==q&&b.Tracker.sendNavCheck("chat",a)},processBufferOpts:function(a,d){var c=b.Storage.get("EG-BUFFER-FLAG");!c||"ON"===c?(a&&(G=a,H=d),b.Exchange.send("isFlagOff")):"OFF"===c&&(i=!1,b.Tracker.sendNav(a,d))},sendNavCheck:function(a,d){C&&(i?h.postMessage&&b.Storage.isStorageSupported()?!1===p?b.Iframe.add(a,d):!0===p&&b.Tracker.processBufferOpts(a,d):(i=!1,b.Tracker.sendNav(a,d)):b.Tracker.sendNav(a,d))},sendNav:function(a,d){var c=g.isEGFIF?h.parent.document:g,e=b.Tracker.getBaseURL(),f=b.Tracker.getCurrentTimeQS(),l="&nTime="+f;d?(w=d.title||c.title,v=d.page||c.URL,u=d.referrer||c.referrer):(w=c.title,v=c.URL,u=c.referrer);c="&pU="+encodeURIComponent(v)+"&pT="+encodeURIComponent(w)+"&pR="+encodeURIComponent(u);"chat"===a&&(c="&ceFlag=1"+c);if(i){var c=l+c,j=b.Storage.get("EG-LnTime","user");j&&j>f&&(c="&flag=nTimeError"+c);b.Storage.set("EG-LnTime",f,"user")}f=e+c;!i&&1940<(f+l).length?(f=(e+"&flag=trimURL"+c).substring(0,1940),c=c.substring(0,1940-e.length-13-l.length)):(e=b.Tracker.getCustomQS(),1940>=(f+l+e).length&&(f+=e,c+=e,b.Tracker._customBuffer=[]));i?(m||(m=b.randomPrefix()+b.uuid(),b.Cache.set("EG-S-ID",m,"session",!0)),k||(c="&isNewUser=1"+c,k=b.randomPrefix()+b.uuid(),b.Cache.set("EG-U-ID",k,"user",!0)),b.Tracker.addToStorageBuffer(c)):(!0===p&&b.Exchange.send("GET"),b.Server.jsonp(f,function(a){if(a.sId){m=a.sId;b.Cache.set("EG-S-ID",m,"session",true)}if(a.uId){k=a.uId;b.Cache.set("EG-U-ID",k,"user",true)}b.Tracker.sendCustom()}))},setUID:function(a){k=a},setTrackerFlag:function(a){if(!1!==q&&(!0===a||"true"==a))i?(b.Storage.set("EG-BUFFER-FLAG","OFF"),b.Exchange.send("GET")):b.Tracker.handleChatEvent({title:w,page:v,referrer:u})},processQ:function(a){for(var d=0;d<a.length;d++){var c=a[d].slice(1,a[d].length);b.Tracker[L[a[d][0]]].apply(null,c)}},processArrayQ:function(){var a=g.isEGFIF?h.parent:h,d=a.EG_CALL_Q||[],d=d.slice(0,d.length);a.EG_CALL_Q=b.CallQueue;b.Tracker.processQ(d)},addToCustomBuffer:function(a,d,c){a=a.toLowerCase();b.Tracker._customBuffer.push({name:"_"+("user"==a?"u":"session"==a?"s":"p")+"_"+encodeURIComponent(d),value:encodeURIComponent(c)})},addToStorageBuffer:function(a){b.Exchange.send("SET",a)},getCustomQS:function(a){for(var d=b.Tracker._customBuffer,c="",a=a||d.length,e=0;e<a;e++)c+="&"+d[e].name+"="+d[e].value;return c},getCurrentTimeQS:function(){return(new Date).getTime()},sendCustom:function(){if(C){var a=b.Tracker.getBaseURL(),d=b.Tracker.getCustomQS(),c="&nTime="+b.Tracker.getCurrentTimeQS();if(0<d.length)if(1940>=(a+d).length||i&&1940>=(a+c+d).length)i?b.Tracker.addToStorageBuffer(c+d):b.Server.jsonp(a+d,function(){}),b.Tracker._customBuffer=[];else for(;b.Tracker._customBuffer.length;)if(d=b.Tracker.getCustomQS(1),c="&nTime="+b.Tracker.getCurrentTimeQS(),b.Tracker._customBuffer.shift(),0<d.length&&(1940>=(a+d).length||i&&1940>=(a+c+d).length))i?b.Tracker.addToStorageBuffer(c+d):b.Server.jsonp(a+d,function(){})}},sendAllFromStorageBuffer:function(a){if(a)for(var a=a.split("|$$|"),d=b.Tracker.getBaseURL(),c=b.Tracker.getCurrentTimeQS();a.length;){var e=a.shift();if(0<e.length){var f="",g="&cTime="+c;b.Tracker.sendFromStorageBuffer(d,f,g,e);0===a.length&&(-1<e.indexOf("&start=1")&&(e=e.replace("&start=1","").replace("&isNewUser=1","")),f="&ceFlag=1",b.Tracker.sendFromStorageBuffer(d,f,g,e))}}},sendFromStorageBuffer:function(a,d,c,e){var f=a+d+c+e;1940<=f.length&&(f=(a+d+c+"&flag=trimURL"+e).substring(0,1940));b.Server.jsonp(f,function(){})}};b.CallQueue={push:function(){b.Tracker.processQ(arguments);b.Tracker.sendCustom()}};b.Exchange={ifrStrToObj:function(a){var b=a.indexOf(","),c=a.substring(11,b-1),a=a.substring(b+12,a.length-2);return{action:c,message:a}},send:function(a,d,c){!1!==p&&("session"!==c&&(c="user"),a='{"action":"'+a+'","scope":"'+c+'","aId":"'+b.Account.getId("account")+'","sId":"'+b.Cache.get("EG-S-ID")+'","message":"'+d+'"}',n.contentWindow.postMessage(a,b.Tracker.getIframeURL()))},receive:function(a){"action"===a.data.substring(2,8)&&(a=b.Exchange.ifrStrToObj(a.data),"bufferData"===a.action&&b.Tracker.sendAllFromStorageBuffer(a.message),"FlagStatus"===a.action&&("OFF"===a.message?(b.Storage.set("EG-BUFFER-FLAG","OFF"),i=!1):b.Storage.set("EG-BUFFER-FLAG","ON"),b.Tracker.sendNav(G,H)))}};b.Iframe={add:function(a,d){n=g.createElement("IFRAME");n.setAttribute("src",b.Tracker.getIframeURL());n.style.display="none";-1<navigator.userAgent.indexOf("MSIE")&&!h.opera?n.onreadystatechange=function(){if("loaded"===n.readyState||"complete"==n.readyState)p=!0,b.Tracker.processBufferOpts(a,d)}:n.onload=function(){p=!0;b.Tracker.processBufferOpts(a,d)};h.addEventListener?h.addEventListener("message",b.Exchange.receive,!1):h.attachEvent("onmessage",b.Exchange.receive);g.getElementsByTagName("head")[0].appendChild(n)}};EGAINCLOUD=b;g.isEGFIF&&(h.parent.EGAINCLOUD=EGAINCLOUD)}(window,document);EGAINCLOUD.init({"aId":"EG36499597","domain":"o2.co.uk,o2priority.co.uk,force.com,ProdO2Copy.o2webchat.net,o2.csb.telefonica.com","delayLoad":"false","apps":[{"name":"Analytics"},{"protocol":"https","contextRoot":"system","name":"Cobrowse","webServer":"chat.o2.co.uk"},{"protocol":"https","contextRoot":"system","name":"Offers","webServer":"chat.o2.co.uk"}]});